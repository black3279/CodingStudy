## 2021/07/17 송명진 프로
## notion url : https://github.com/RumbleKAT/WeekEndStudy/blob/main/docker.md

## Docker 란 ?
- 컨테이너 기반의 오픈소스 가상화 플랫폼이다.
- 기존의 가상화 방식은 OS 를 가상화하여 호스트 OS 위에 게스트 OS 전체를 가상화하여 사용하는 방식이다.
- 반가상화 방식으로는 Xen 이 드앚ㅇ했다. 게스트 OS 가 필요하지만, CPU 등 일부를 가상화하여 효율을 높일 수 있었다.
- 이러한 기술들은 OpenStack 이나 AWS 같은 클라우드 서비스에서 가상화 컴퓨팅 기술의 기반이 되었다.
- 컨테이너 개념은 기존에도 리눅스에서 cgroup, LXC 등이 있었다.
- Docker hub 는 Docker pool 을 가져와서 이미지를 커스터마이징 할 수 있다.

## 레이어 저장 방식
- 도커 이미지는 컨테이너를 실행하기 위한 모든 정보를 가지고 있어서 용량이 크다.
- 이러한 비효율 문제를 해결하기위한 방식이 레이어 이다.
- 유니온 파일 시스템을 사용하여 특정 레이어 만을 관리하는 방식으로 용량 관리를 효율적으로 할 수 있다.

## Dockerfile
- 어떤 이미지를 사용해서 빌드할것인지를 정의한다.
- .dockerignore 에는 도커 이미지를 올릴 때 어떤 것을 제외할지 정의할 수 있다.
- docker build/images 명령어를 통해 빌드를 하고 이미지를 확인할 수 있다.

## 명령어
- run 은 새로 이미지를 띄우고 exec 은 실행중인 컨테이너에 명령을 내린다.
- \-d 이미지를 실행하면 분리모드로 컨테이너를 실행해서 백그라운드에서 컨테이너가 돌아가도록 한다.
- \-p 플래그는 공개포트를 컨테이너 내의 비공개 포트로 리다이렉트 한다.
- ps 는 아이디를 확인하며 logs 는 앱 로그를 출력한다.
- \-a 를 붙이면 맨 처음 실행했다가 종료된 컨테이너도 추가로 볼 수 있다. (종료되어도 삭제되지 않고 남아있다)

## 컨테이너 업데이트
- 컨테이너 업데이트 시에는 기존 컨테이너가 삭제되기 때문에 유지해야하는 데이터는 반드시 외부 스토리지 (AWS S3, Data Volume) 에 저장해야 한다.
- 데이터 볼륨을 생성한 후 동일한 디렉토리를 마운트 하면 데이터를 그대로 사용할 수 있다.

### 설정의 경우, yaml 파일을 통해 설정을 하게 된다.

## 실습
- 도커 실행 시 레이어 구조대로 빌드되어 이미지가 만들어진다.
- docker images 명령어를 통해 현재 올라간 이미지를 확인할 수 있다.
- docker run 레파지토리경로 를 통해 해당 이미지를 실행시킬 수 있다.
- docker ps 명령어를 통해 해당 컨테이너의 ID 를 가져와서 exec 커맨드를 통해 해당 컨테이너에 명령을 실행시킬 수 있다.
