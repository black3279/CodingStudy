- 2021/07/11 장태진 프로

## AWS Lambda 로 시작하는 서버리스 AWS

## 서버리스란
- 서버에서 처리하는 작업을 클라우드 기반 서비스로 처리하여 관리비용을 낮추고 유지 보수의 어려움을 줄일 수 있다.

## 서버리스의 형태
- Baas : 백엔드 부분 부분 서비스로 제공받는 것
- FaaS : 실행할 함수 단위만 개발한다.
        - 원하는 로직만 함수 기반으로 구현
        - 함수 호출 시 컨테이너가 실행되며 정의한 함수가 런타임 내 실행된 다음 컨테이너가 종료됨
        - 단일 함수로 간단한 작업뿐만 아니라 함수, 다른 서비스를 연결하는 복잡한 로직 ㅜㄱ현 가능
        - AWS Lambda 가 대표적이다.
        
## 서버리스의 구조
- 클라이언트가 인증받는다.
- 인증받은 클라이언트가 API를 통해 람다를 호출한다.
- 람다가 API 에 응답을 준다.
- API 가 클라이언트에게 응답을 준다.

## Scale-out / Scale-up
- 스케일 아웃 : 서버 여러대를 추가하여 시스템을 확장하는 방법으로 균등분배를 위해 로드밸런서가 필수적이다.
- 스케일 업 :CPU, RAM 업그레이드
- 기존 온프레미스 환경의 구조의 경우 위 두 가지를 고려하여 확장 및 업그레이드를 해야하지만 Faas 는 스케일링 자동화가 되어있다.

## 서버리스를 사용하는 이유
- 개발에 집중할 수 있고 코드 유지보수나 기능 추가에 효율적이며 타 시스템과 연계할 때 유용하고, 비용적으로 유리하다.

## 서버리스의 단점
- 장기간 지속 작업에는 부적합하며 (기능,비용) 함수는 항상 준ㄴ비 상태가 아니어서 콜드 스타트, 웜 스타트가 발생한다.

## AWS Lambda
- AWS 에서 제공하는 FaaS 서비스이다.
- 람다의 실행 후 언어별 런타임 환경을 준비하고 실행 환경을 맞추고 Micro VM 을 실행한 후에야 이벤트를 처리하는, 콜드 스타트가 발생한다.
- 사용자의 코드를 실행하는 부분이 웜 스타트이다.
- Micro VM 이 새로 실행되면 Full cold start 부터 실행하며, 유지되는 타이밍에 요청이 오면 Partial cold start 가 바로 진행된다.
- cold start 를 줄일 수 있는 방안은 지속적 호출을 통해 micro VM 을 유지하는 방법이다. ( 현재 완벽한 해결방안은 없음 )

## AWS Lambda 의 런타임
- 다른 언어로 작성한 코드들도 동일한 기본 환경에서 실행가능하다.
- 동기식 : 클라이언트가 람다 함수에 이벤트를 보내고 클라이언트는 함수 응답을 받는다, 파라미터 값은 invoke 로 실행한다.
- 비동기식 : 클라이언트 요청 이벤트와 람다 함수 사이에 대기열을 이용하여 클라이언트는 성공 응답만 받는다, 파라미터 값은 Event 로 설정한다.
            - 오류 발생 시 재시도하는데, 설정 값과 서버 오류 코드에 따라 이벤트를 대기열로 보내고 특정 시간동안 최대 5분 간격으로 재시도를 수행한다.

## 메모리 할당과 실행 제한 시간
- 메모리는 128 ~ 3008 Mb 까지 64Mb 단위로 직접 설정 가능
- 실행 제한 시간은 설정가능하며 리소스는 메모리 설정에 따라 자동 할당된다.

## 태그
- 키 값 형식의 태그 사용 가능하며 UTF-8 으로 표현 가능한 문자(대소문자 구분), 공백, 숫자 그리고 특수문자만 사용한다.

## Amazon API Gateway
- REST API, WebSocket API, HTTP API 만 존재한다.
- API 와 관련된 모든 작업을 처리한다.

### HTTP API
- 매번 새로운 연결 시도 및 해제 때문에 오버헤드가 발생할 수 있어 KeepAlive 를 통해 보완해주는 방법이 필요할 수 있다.
- 메소드와 응답 상태코드를 함께 명시하여 보내주어야 한다.

### REST API
- 자원에 고유한 URI 를 부여하는 방식으로 캨싱 처리가 가능하며 구조적으로 계층화하며 유연하게 관리가 가능하며, 서버로부터 스크립트를 받아 클라이언트에서 실행 가능하다.
- 인터페이스에 일관성이 있다.
- MIME Type 은 표현방식을 의미한다.

### 차이점
- HTTP API 가 3배 저렴하며 대기시간도 최대 60% 이상 줄일 수 있으나, 프록시 기능만 제공하며 그에 최적화되어 있다.
- 본인의 환경에 따라서 API 를 선택하여야 한다.
- 캐시 기능, 요청/응답 검증 등과 같은 기능이 필요한 경우에는 REST API 를 선택하여야 한다.

### WebSocket API
- 서버와 클라이언트 간 소켓 연결을 통해 양방향으로 혹은 데이터를처리하는 API

## 모니터링

### Amazon CloudWatch
- AWS 리소스와 실행 중인 어플리케이션을 모니터링 한다.
- 기본개념으로 매트릭, 자원, 통계, 경보가 존재한다.
- 매트릭은 ㅅ간순으로 정렬된 데이터 포인트 집합이다.
- 차원의 츠겆ㅇ 기준은 측정항목의 고유 식별자이므로 측정항목 중 하나에 고유한 이름/값 쌍을 추가할 때마다 해당 측정항목의 새로운 벼녛ㅇ을 만든다.

### Amazon CloudWatch Logs
- 람다 별로 이벤트를 관찰할 수 있으며 해당 내용의 세부 사항들을 트레이스 할 수 있다.
