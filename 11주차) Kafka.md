- 2021/06/12 장원용 프로
- https://wonyong-jang.github.io/bigdata/2021/02/09/BigData-Kafka.html

# Kafka 란 ?

- 링크드인에서 하기 목표를 실현하고자 개발하였다.

	- 높은 처리량의 실시간 처리
	- 임의의 타이밍에서 데이터를 읽는다 ( 소스 -> 타겟 )
	- 다양한 제품과 시스템에 쉽게 연동
	- 메시지 손실이 없다
	
## 메시지 큐 구조

- Producer(Sender) -> Queue(Message) -> Consumer(Receiver)
- 대표적으로 카프카 래빗MQ, 액티브MQ 가 있다

## 사용 이유
- 카프카 도입 전에는 데이터 플로우가 복잡하여 장애 등 발생 시, 데이터 동기화하거나 파이프라인 확장/조정이 어려움
- 카프카를 도입하면 카프카를 중심으로 복잡도를 감소시키고 실패 시 재처리가 가능하는 등 장점이 있다.
- 하지만, 큐에 병목현상이 발생할 수 있다.

### RabbitMQ
- RabbitMQ 가 오래되었으나, 분산/고성능/대용량/노드장애 대응을 추구한다면 카프카가 좋다.
- 하지만 분산까지 할 규모가 아니라면 RabbitMQ 가 나을 수 있다. (다양한 기능 존재)
- 카프카는 다른 메시지 큐와 다르게 클라이언트가 읽은 다음 메시지를 삭제하지 않고, 오프셋 기능을 사용한다.

## 카프카 특징
1) High throughput message capacity
	: 파티션을 통한 분산처리와 컨슈머 개수 증가를 통한 병렬적으로 처리가 가능하다.
2) Scalability 와 Fault tolernat
	: 카프카는 확장성이 뛰어 나다. 부하가 생겨서 Scale out 을 해야할때 클러스터를 늘렸다가, Scale in 하는데 유연하다.
...

## Publish-Subscribe 모델
- Producer 와 Consumer 사이에 Broker 로 구성된 느슨한 결합 시스템이다.
- Producer 는 Broker 를 통해 메시지를 발행한다.
- 빗대어설명) 신문사에서 신문 종류를 topic 이라고 하면 여기에 메시지를 쓰고, 구독자는 해당 토픽의 데이터를 소비해간다.
- topic 을 데이터 종류 별로 구분하여 해당 topic 만 구분하여 메시지를 가져갈 수 있게 된다.


### 정리
- 카프카는 특정 토픽으로 메시지를 발행할 수 있고, 컨슈머는 토픽의 메시지를 읽어갈 수 있다. 프로듀서와 컨슈머는 의존성이 없는데, 이는 카프카가 중간에서 연결해주기 때문이다.

## 카프카의 구조
- 카프카 클러스터 안에 파티션이 존재한다.
- 파티션이란 분산처리를 위해 존재하며 파티션을 큐로 볼 수 있다.
- 파티션을 쓰는 이유는 분산저장을 하기 위한 것인데, 줄일 수 없으므로 신중하게 결정해야 한다.
- 데이터를 어떤 파티션에 넣을지는 클러스터 내부에서 거의 랜덤하게 들어하게 들어가고 빼가는데, 순서가 중요한 데이터는 파티션을 1개로만 유지해야 한다.

참고) 주키퍼, 설정방식 등